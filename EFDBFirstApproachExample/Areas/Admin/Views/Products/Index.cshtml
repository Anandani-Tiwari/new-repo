@model List<EFDBFirstApproachExample.Models.Product>
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/AdminLayoutPage1.cshtml";
}

<h2>Products</h2>
@* hyperlink to create new product *@
<a href="/admin/products/create">Create</a>
@* Search bar *@
<form class="form-inline" action="/admin/products/index">
@Html.Label("Search",new {@class="mr-1" })
@Html.TextBox("Search",ViewBag.search as string,new {@class= "form-control mr-1",placeholder= "search" })  
<button type="submit" class="btn btn-primary">Go</button>
</form>
@* Table content *@
<table class="table">
    <tr class="table-secondary">
        <th style="width:15%">
            Photo
        </th>
        <th style="width:10%">
            @if (ViewBag.IconClass == "fa-sort-desc")
            {
                <a href="/admin/products/index?SortColumn=ProductId&IconClass=fa-sort-asc">ProductId</a>
                if(ViewBag.SortColumn =="ProductId")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
            else
            {
                <a href="/admin/products/index?SortColumn=ProductId&IconClass=fa-sort-desc">ProductId</a>
                if(ViewBag.SortColumn=="ProductId")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
        </th>
        <th style="width:25%">
            @if (ViewBag.IconClass == "fa-sort-desc")
            {
                <a href="/admin/products/index?SortColumn=ProductName&IconClass=fa-sort-asc">ProductName</a>
                if (ViewBag.SortColumn == "ProductName")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
            else
            {
                <a href="/admin/products/index?SortColumn=ProductName&IconClass=fa-sort-desc">ProductName</a>
                if (ViewBag.SortColumn == "ProductName")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
        </th>
        <th style="width:15%">
            @if (ViewBag.IconClass == "fa-sort-desc")
            {
                <a href="/admin/products/index?SortColumn=AvailabilityStatus&IconClass=fa-sort-asc">AvailabilityStatus</a>
                if (ViewBag.SortColumn == "AvailabilityStatus")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
            else
            {
                <a href="/admin/products/index?SortColumn=AvailabilityStatus&IconClass=fa-sort-desc">AvailabilityStatus</a>
                if (ViewBag.SortColumn == "AvailabilityStatus")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
        </th>
        <th style="width:15%">
            
            @if (ViewBag.IconClass == "fa-sort-desc")
            {
                <a href="/admin/products/index?SortColumn=DateOfPurchase&IconClass=fa-sort-asc">DateOfPurchase</a>
                if (ViewBag.SortColumn == "DateOfPurchase")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
            else
            {
                <a href="/admin/products/index?SortColumn=DateOfPurchase&IconClass=fa-sort-desc">DateOfPurchase</a>
                if (ViewBag.SortColumn == "DateOfPurchase")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
        </th>
        <th style="width:10%">
            @if (ViewBag.IconClass == "fa-sort-desc")
            {
                <a href="/admin/products/index?SortColumn=BrandId&IconClass=fa-sort-asc">BrandId</a>
                if (ViewBag.SortColumn == "BrandId")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
            else
            {
                <a href="/admin/products/index?SortColumn=BrandId&IconClass=fa-sort-desc">BrandId</a>
                if (ViewBag.SortColumn == "BrandId")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
        </th>
        <th style="width:10%">
            @if (ViewBag.IconClass == "fa-sort-desc")
            {
            <a href="/admin/products/index?SortColumn=CategoryId&IconClass=fa-sort-asc">CategoryId</a>
                if (ViewBag.SortColumn == "CategoryId")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
            else
            {
                <a href="/admin/products/index?SortColumn=CategoryId&IconClass=fa-sort-desc">CategoryId</a>
                if (ViewBag.SortColumn == "CategoryId")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
        </th>
        <th style="width:5%">
            
            @if (ViewBag.IconClass == "fa-sort-desc")
            {
        <a href="/admin/products/index?SortColumn=Price&IconClass=fa-sort-asc">Price</a>
                if (ViewBag.SortColumn == "Price")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
            else
            {
        <a href="/admin/products/index?SortColumn=Price&IconClass=fa-sort-desc">Price</a>
                if (ViewBag.SortColumn == "Price")
                {
                    <i class="fa @ViewBag.IconClass"></i>
                }

            }
        </th>
        <th style="width:10%"></th>
    </tr>
    @foreach (var product in Model)
    {
               <tr>
                   <td><img src="data:imsge;base64,@product.Photo" width="100px" /></td>
                    <td>@Html.DisplayFor(temp=>product.ProductId)</td>
                    <td>@Html.DisplayFor(temp=>product.ProductName)</td>
                    <td>@Html.DisplayFor(temp=>product.AvailabilityStatus)</td>
                    <td>@Html.DisplayFor(temp=>product.DateOfPurchase)</td>
                    <td>@Html.DisplayFor(temp=>product.BrandId)</td>
                    <td>@Html.DisplayFor(temp=>product.CategoryId)</td>
                    <td>@Html.DisplayFor(temp=>product.Price)</td>
                   <td>
                   @Html.ActionLink("Details","Details",new {id= product.ProductId,controller="Products",Area="Admin"})
                   </td>
                </tr>
    }

    <tr>
        <td colspan="9">
            @{ 
                int prevPageNo = ViewBag.PageNo - 1;
                if (prevPageNo <= 0)
                {
                    prevPageNo = 1;
                }
                int nextPageNo = ViewBag.PageNo + 1;
                if (nextPageNo > ViewBag.NoOfPages)
                {
                    nextPageNo = ViewBag.NoOfPages;
                }
            }
            <ul class="pagination justify-content-center">
                <li class="page-item">
                    <a class="page-link" href="/admin/products/index?PageNo=@prevPageNo">Prev</a>
                </li>
                @for (int i = 0; i < ViewBag.NoOfPages; i++)
                {
                    if ((i + 1) == ViewBag.PageNo)
                    {
                        <li class="page-item active">
                            <a class="page-link" href="/admin/products/index?PageNo=@(i+1)&IconClass=@ViewBag.IconClass">@(i+1)</a>
                        </li>
                    }
                    else
                    {
                        <li class="page-item"><a class="page-link" href="/admin/products/index?PageNo=@(i+1)">@(i+1)</a></li>
                    }

                }
                <li class="page-item">
                    <a class="page-link" href="/admin/products/index?PageNo=@nextPageNo">Next</a>
                </li>
            </ul>
        </td>
    </tr>
</table>

